discover_competitors:
  description: >
    입력 아이디어를 기반으로 직접/간접 경쟁사 및 대체재를 최소 15개 발굴한 뒤,
    최종 분석 대상 상위 8~10개를 추천하라.

    [핵심 원칙]
    - "없다"는 결론을 쉽게 내리지 말고, 해외 사례/대체재/워크어라운드까지 폭넓게 찾는다.
    - 각 후보가 왜 유사한지(문제/타깃/행동/가치제안 중 무엇이 겹치는지)를 한 문장으로 명확히 써라.
    - 추측 금지: 확인하지 못한 내용은 "추정"으로 표시하거나 제외한다.

    [입력]
    아이디어: {idea_one_liner}
    타깃: {target_customer}
    문제: {problem_statement}
    현재 대안: {current_alternatives}
    시장: {geo_market} / {business_type}
    제약: {constraints}

    [분류 기준]
    - Direct: 같은 타깃+같은 문제를 같은 방식으로 해결
    - Indirect: 같은 문제를 다른 방식으로 해결(또는 인접 타깃)
    - Substitute: 고객이 지금 실제로 쓰는 대체 행동/도구/서비스

  expected_output: >
    아래 JSON을 마크다운 코드블록으로 출력하라. (반드시 JSON 유효)
    - items는 8~10개(최종 분석 대상)
    - candidates는 15~30개(풀 리스트; 간단히)
    - 모든 항목에 url은 "필수" (공식 사이트/앱스토어/제품 페이지/소개 페이지 중 하나)
    - why_similar는 1문장, keywords는 3~8개
    {
      "items": [
        {
          "name": "string",
          "type": "Direct|Indirect|Substitute",
          "why_similar": "string",
          "keywords": ["string"],
          "url": "https://...",
          "notes": "string"
        }
      ],
      "candidates": [
        {"name":"string","type":"Direct|Indirect|Substitute","url":"https://...","keywords":["string"]}
      ],
      "search_terms_used": ["string"]
    }
  agent: competitor_discovery

# ============================================================================
# Context 압축 태스크 (TPM 관리의 핵심)
# ============================================================================

compact_competitors:
  description: >
    discover_competitors 결과에서 downstream 분석에 필요한 최소 정보만 남겨라.
    
    [압축 규칙]
    - items(상위 8~10개)의 name/type/url/keywords/why_similar만 유지
    - candidates, search_terms_used, notes 등은 제거하거나 1줄로 요약
    - 출력은 반드시 1KB~2KB 이내로 제한하라
    - 불필요한 상세 설명, 중복 정보는 과감히 제거
    
    [왜 이게 필요한가]
    - 다음 단계(채널 분석, VP 추출)가 이 압축본을 참조함
    - raw 결과를 그대로 넘기면 토큰이 폭발함
    
  expected_output: >
    아래 JSON을 마크다운 코드블록으로 출력하라:
    ```json
    {
      "competitors_summary": "전체 경쟁 구도 1~2문장 요약",
      "items": [
        {
          "name": "경쟁사명",
          "type": "Direct|Indirect|Substitute",
          "url": "https://...",
          "keywords": ["키워드1", "키워드2"],
          "why_similar": "유사 이유 1문장"
        }
      ],
      "key_patterns": "경쟁사들의 공통 패턴 1~2문장"
    }
    ```
  agent: competitor_discovery
  context:
    - discover_competitors

# ============================================================================
# 채널/VP 분석 (compact_competitors 기반)
# ============================================================================

analyze_channels:
  description: >
    compact_competitors의 items(상위 8~10개)를 대상으로
    "그들은 어떻게 고객에게 닿는가"를 채널 중심으로 분석하라.

    [⚠️ 토큰 절약 - 필수 준수]
    - **한 번에 최대 3개 경쟁사만 스크래핑하라.** 나머지는 검색 결과 snippet으로 분석.
    - 스크래핑 시 **페이지 상단 400자 이내**만 읽어라. 전체 페이지를 읽지 마라.
    - 검색만으로 충분한 정보가 있으면 스크래핑을 생략하라.

    [출력 제한 - 반드시 준수]
    - **competitor당 channels 최대 2개만** (가장 중요한 채널만)
    - **각 array(message_patterns, audience_callout 등)는 최대 3개씩만**
    - **notes는 1줄(30자) 이내 또는 생략**
    - **전체 items는 최대 5개** (중요도 순)

    [분석 범위]
    - 채널 후보: 검색(SEO/SEM), 유튜브, 인스타, 틱톡, 블로그, 뉴스레터, 커뮤니티, 파트너십, 마켓플레이스 등
    - 각 채널에서 반복되는 메시지/후킹/CTA 패턴을 뽑아라.
    - "어떤 고객을 호명하는지"를 반드시 추출하라.

    [중요]
    - 스크래핑/검색 결과에서 확인한 사실만 쓰고, 추측은 "추정"으로 표시.
    - 메시지는 그대로 복붙이 아니라 "요약+패턴화" 하라.

  expected_output: >
    아래 JSON을 마크다운 코드블록으로 출력하라. (반드시 JSON 유효)
    - items는 최대 5개
    - channels는 competitor당 최대 2개
    - 각 array는 최대 3개씩
    {
      "items": [
        {
          "competitor": "string",
          "channels": [
            {
              "channel_type": "string",
              "message_patterns": ["max 3"],
              "audience_callout": ["max 3"],
              "emotion_triggers": ["max 3"],
              "cta_patterns": ["max 3"]
            }
          ]
        }
      ],
      "cross_competitor_patterns": {
        "most_common_channels": ["max 3"],
        "common_hooks": ["max 3"],
        "common_ctas": ["max 3"],
        "common_emotions": ["max 3"]
      }
    }
  agent: channel_intel
  context:
    - compact_competitors  # 슬림한 경쟁사 정보만 참조 (TPM 최적화)

extract_value_props:
  description: >
    compact_competitors의 items(상위 8~10개)에 대해
    랜딩/상세 페이지 관점에서 핵심 가치제안(카피/기능/증거/가격/마찰)을 분해하라.

    [⚠️ 토큰 절약 - 필수 준수]
    - **한 번에 최대 3개 경쟁사만 스크래핑하라.** 나머지는 이전 태스크 결과에서 추론.
    - 스크래핑 시 **페이지 상단 400자 이내**만 분석. 전체 페이지를 읽지 마라.
    - 스크래핑이 실패하거나 너무 길면 **검색 결과의 snippet만으로 분석**하라.

    [출력 제한 - 반드시 준수]
    - **전체 items는 최대 5개** (중요도 순)
    - **features 최대 5개**, proofs 각 카테고리 최대 2개
    - **notes는 1줄(30자) 이내 또는 생략**
    - **hero_copy_original은 20단어 이내**
    - **sub_copy_summary, audience_definition, friction은 각 최대 3개**

    [노이즈 줄이기 지시]
    - 페이지 전체를 요약하지 말고, "Hero(상단)" 중심으로 추출한다.
    - Hero copy 후보는 원문 문구를 짧게 인용(최대 20단어).
    - USP 후보는 "여기만 말하는 제안"을 1~2개로 태깅한다.
    - 가격/플랜이 없으면 "not_found"로 표기하고 넘어가라.

    [검증 관점]
    - "누구에게"를 페이지에서 어떻게 특정하는지 추출한다.
    - 마찰(friction)은 핵심 2개만 적는다.

  expected_output: >
    아래 JSON을 마크다운 코드블록으로 출력하라. (반드시 JSON 유효)
    - items 최대 5개
    - 각 array 최대 3개 (proofs는 각 2개)
    - notes 생략 또는 1줄
    {
      "items": [
        {
          "competitor": "string",
          "hero_copy_original": "max 20 words",
          "hero_copy_summary": "1줄 요약",
          "audience_definition": ["max 3"],
          "usp_candidates": ["max 2"],
          "features": ["max 5"],
          "proofs": {
            "numbers": ["max 2"],
            "logos": ["max 2"]
          },
          "pricing": "string or not_found",
          "friction": ["max 3"]
        }
      ],
      "vp_comparison_matrix": {
        "common_promises": ["max 3"],
        "common_frictions": ["max 3"]
      }
    }
  agent: vp_extractor
  context:
    - compact_competitors  # 슬림한 경쟁사 정보만 참조 (TPM 최적화)

mine_gaps:
  description: >
    summarize_channels_vp(압축된 채널/VP 정보)만 근거로 삼아
    경쟁사가 해결하지 못했거나 새로 만든 부작용/불만을 바탕으로
    빈틈 가설 8~15개를 생성하라.

    ═══════════════════════════════════════════════════════════════
    🚨 [IDEA SCOPE BOUNDARY] - 아이디어 범위 제한 (필수)
    ═══════════════════════════════════════════════════════════════
    
    [입력 아이디어 참조]
    - 아이디어: {idea_one_liner}
    - 문제: {problem_statement}
    - 타깃: {target_customer}
    
    ⚠️ 빈틈 가설은 반드시 입력 아이디어의 **범위 내**에서만 도출하라.
    
    ❌ 금지되는 것:
    - 입력 문제와 다른 문제를 해결하는 빈틈 제안
    - 입력 타깃과 다른 타깃을 위한 빈틈 제안
    - 입력 아이디어의 핵심 행동을 바꾸는 빈틈 제안
    
    ✅ 허용되는 것:
    - 입력 문제를 더 **날카롭게** 표현하는 것
    - 입력 타깃을 더 **좁히는** 것 (예: "의료진" → "응급실 간호사")
    - 입력 아이디어를 더 **구체화**하는 것
    
    👉 **모든 빈틈 가설은 입력 아이디어의 "변형"이 아니라 "심화"여야 한다.**

    ═══════════════════════════════════════════════════════════════

    [⚠️ 중요: 데이터 소스 제한]
    - 이 태스크는 summarize_channels_vp만 참조하라
    - raw 출력(analyze_channels, extract_value_props 원본)을 직접 추측하지 마라
    - 주어진 압축 데이터에서 관찰된 사실만 근거로 사용하라

    [빈틈 가설 작성 규칙]
    - 반드시 "특정 고객 세그먼트"와 "특정 순간(moment)"을 포함해야 한다.
    - gap_type은 아래 taxonomy 중 하나로 라벨링:
      비용/수수료/의존, 과기능/복잡함, 러닝커브, 세그먼트 소외, 신뢰/품질, 워크플로우 단절,
      속도/즉시성, 커스터마이징 부족, 데이터/보안, 운영 부담, 결과 일관성, 기타
    - insight는 "왜 기존 대안이 부족한지"를 경쟁사 관찰 근거로 논리적으로 작성한다.
    - validation_signals는 반드시 포함:
      * 고객이 실제로 검색할 법한 키워드 2~5개
      * 커뮤니티/리뷰에서 나올 법한 불만 문장 2~4개(가상 가능하지만 '가상' 표기)
    - proposed_angle은 STEP2 카피로 이어질 수 있게 "한 문장 제안"으로 써라.
    
    [출력 시 필수 포함]
    - 각 빈틈 가설이 입력 아이디어와 어떻게 연결되는지 명시
    - 입력 범위를 벗어난 가설이 있으면 별도 표시 (⚠️ 범위 외)

  expected_output: >
    아래 JSON을 마크다운 코드블록으로 출력하라. (반드시 JSON 유효)
    - items 8~15개
    {
      "items": [
        {
          "id": "GAP-001",
          "target_segment": "string",
          "moment": "string",
          "gap_type": "string",
          "insight": "string",
          "validation_signals": {
            "search_keywords": ["string"],
            "community_phrases": ["string"]
          },
          "proposed_angle": "string",
          "which_competitors_triggered": ["string"]
        }
      ],
      "top_gap_types": ["string"],
      "notes": "string"
    }
  agent: gap_miner
  context:
    - summarize_channels_vp  # 압축된 채널/VP 정보만 참조 (TPM 최적화)

# ============================================================================
# SUMMARIZE CHANNELS + VP - mine_gaps context 슬림화 (가드레일 #3)
# ============================================================================

summarize_channels_vp:
  description: >
    analyze_channels와 extract_value_props 결과를 mine_gaps 용도로만 압축하라.
    
    ⚠️ 중요: "Above JSON..." 같은 메타 설명 금지! 반드시 실제 JSON 데이터를 출력하라.
    
    [⚠️ 하드 제한 - 반드시 준수]
    - **competitors는 최대 5개만 포함하라.**
    - **message_patterns/usp_or_promise/frictions 등 배열은 각 최대 3개.**
    - **각 문자열은 120자 이내. 초과 시 잘라라.**
    - 전체 출력은 1200자 이내로 제한하라.
    
    [압축 규칙]
    - competitor별로 아래만 남겨라:
      1) audience 요약 1줄 (120자 이내)
      2) message_patterns 3개 (각 120자 이내)
      3) usp_or_promise 2개 (각 120자 이내)
      4) pricing 1줄 (없으면 "not_found")
      5) frictions 2개 (각 120자 이내)
    - hero_copy 전문, proofs 상세, URL, 긴 인용문은 모두 버려라
    
    [왜 필요한가]
    - 다음 단계(gap_miner)가 이 압축본만 참조함
    - mine_gaps에 필요한 건 "근거가 되는 관찰"이지, 페이지 카피 전문이 아님
    
    [출력 형식 - 필수]
    - 반드시 ```json 코드블록 안에 실제 JSON 데이터를 출력하라
    - 설명 문장, 메타 코멘트, "Above JSON..." 등 금지
    
  expected_output: >
    반드시 아래 JSON 형식으로 실제 데이터를 출력하라 (1200자 이내):
    ```json
    {
      "competitors": [
        {
          "name": "경쟁사명",
          "audience": "타깃 호명 1줄",
          "message_patterns": ["패턴1", "패턴2", "패턴3"],
          "usp_or_promise": ["USP1", "USP2"],
          "pricing": "가격 핵심 또는 not_found",
          "frictions": ["마찰1", "마찰2"]
        }
      ],
      "cross_patterns": {
        "common_audiences": ["공통 타깃1", "공통 타깃2"],
        "common_hooks": ["공통 후킹1", "공통 후킹2", "공통 후킹3"],
        "common_emotions": ["감정1", "감정2"],
        "common_frictions": ["공통 마찰1", "공통 마찰2"]
      }
    }
    ```
  agent: research_summarizer
  context:
    - analyze_channels
    - extract_value_props

# ============================================================================
# SUMMARIZE RESEARCH - orchestrator context 슬림화
# ============================================================================

summarize_research:
  description: >
    지금까지의 모든 리서치 결과(경쟁사, 채널, VP, Gap 가설)를
    의사결정에 필요한 핵심 내용만 1~2페이지로 압축하라.
    
    ⚠️ 중요: "Above content..." 같은 메타 설명 금지! 반드시 실제 마크다운 데이터를 출력하라.
    
    [목적]
    - orchestrator(최종 판단자)가 전체 리서치를 빠르게 이해할 수 있게
    - 토큰 사용량 최적화 (상세 데이터 대신 요약본 전달)

    [요약 범위 - 반드시 포함]
    1) 경쟁사 핵심 요약:
       - Direct 경쟁사 Top 5 (이름, URL, 핵심 차별점 1문장)
       - 주요 대체재 Top 3 (이름, 왜 대체재인지 1문장)
    
    2) 채널/메시지 패턴:
       - 가장 효과적인 채널 Top 3
       - 공통 후킹/CTA 패턴 3개
       - 공통 감정 트리거 2~3개
    
    3) 가치제안(VP) 핵심:
       - 공통 약속(Promise) 패턴 3개
       - 차별화 포인트 패턴 3개
       - 공통 마찰(Friction) 3개
    
    4) Gap 가설 Top 5:
       - id, target_segment, gap_type, insight(1문장), proposed_angle
       - 검증 키워드 2~3개씩

    [출력 제한]
    - 전체 1,500~2,000 토큰 이내
    - 불필요한 디테일, 중복, 예시는 과감히 생략
    - 패턴/인사이트/결론 중심
    
    [출력 형식 - 필수]
    - 반드시 아래 마크다운 구조로 실제 데이터를 출력하라
    - 설명 문장, 메타 코멘트, "Above content..." 등 금지
    - 표(|)와 리스트(-)를 사용해 구조화하라

  expected_output: >
    반드시 아래 구조의 마크다운으로 실제 데이터를 출력하라:
    ## Research Summary for Decision Making
    
    ### 1. 경쟁사 핵심 (Direct 5 + 대체재 3)
    | 유형 | 이름 | URL | 핵심 차별점 |
    ...
    
    ### 2. 채널/메시지 패턴
    - Top 채널: ...
    - 공통 후킹: ...
    - 감정 트리거: ...
    
    ### 3. VP 핵심
    - 공통 약속: ...
    - 차별화 포인트: ...
    - 공통 마찰: ...
    
    ### 4. Gap 가설 Top 5
    | id | 세그먼트 | 유형 | 인사이트 | 검증 키워드 |
    ...
    
    ### 5. 핵심 시사점 (3문장)
    - ...
    
  agent: research_summarizer
  context:
    - compact_competitors  # 슬림한 경쟁사 정보
    - summarize_channels_vp  # 압축된 채널/VP 정보
    - mine_gaps

create_pov_and_positioning:
  description: >
    mine_gaps의 빈틈 가설을 바탕으로,
    "우리만의 관점(POV)" 2~3개와
    차별화 가치제안(포지셔닝) 3안을 만들어라.

    ═══════════════════════════════════════════════════════════════
    🚨 [IDEA INVARIANCE RULE] - 아이디어 보존 규칙 (필수)
    ═══════════════════════════════════════════════════════════════
    
    ⚠️ 절대 변경 금지 항목:
    - **core_problem**: 입력에서 정의된 핵심 문제 (예: "감정 기록" ≠ "스트레스 회복")
    - **primary_action**: 사용자의 주요 행동 (예: "기록하다" ≠ "즉시 회복하다")
    - **usage_context**: 사용 맥락 (예: "회고/성찰용" ≠ "실시간/즉각적")
    
    ✅ 허용되는 변경:
    - 타깃 세그먼트를 **좁히는** 것 (넓히기 ❌)
    - 문제의 **구체적 표현**을 다듬는 것 (다른 문제로 바꾸기 ❌)
    - 경쟁사 빈틈을 **추가 강조**하는 것 (문제 자체를 바꾸기 ❌)
    
    [입력 아이디어 참조 - 반드시 확인]
    - 아이디어: {idea_one_liner}
    - 문제: {problem_statement}
    - 타깃: {target_customer}
    
    👉 **모든 포지셔닝 옵션은 위 입력과 일관성을 유지해야 한다.**
    👉 **입력 아이디어와 다른 제품이 되면 STEP1 실패로 간주한다.**

    ═══════════════════════════════════════════════════════════════

    [각 포지셔닝 옵션 필수 요소]
    - POV 1문장: "우리는 시장을 이렇게 본다"
    - 핵심 타깃/상황: "누구의 어떤 순간"
    - Promise(약속) 1문장: 결과/효과를 구체적으로(가능하면 수치/비율/시간)
    - Reasons to Believe: 근거/메커니즘/차별화 포인트 3개
    - Feature Focus:
      * must_have 3~5개
      * should_have 2~4개
      * will_not_do 2~4개 (범위 관리)
    - 경쟁 대안 대비 비교 메시지 2~3개(너무 공격적 문구 말고 명확한 차이)
    - STEP2 Hero 카피 초안 5개(모호한 표현 금지)

    [품질 조건]
    - 빈틈 가설의 validation_signals를 참조해 "실제 표현"과 연결하라.
    - 단순한 기능 나열이 아니라, 관점 → 제안 → 기능이 자연스럽게 이어져야 한다.

  expected_output: >
    아래 마크다운으로 출력하라:
    
    ## 🔒 아이디어 보존 체크
    - 입력 아이디어: (원문 그대로)
    - 포지셔닝에서 유지된 핵심: (무엇이 유지되었는지)
    - ⚠️ 변경/확장된 부분: (있다면 명시, 없으면 "없음")
    
    ---
    
    - Option A/B/C로 구분
    - 각 Option마다 위 필수 요소를 섹션으로 포함
    - 마지막에 "추천 Option(1개)"과 "왜 이게 가장 설득력 있는지"를 5줄 이내로 요약
  agent: pov_strategist
  context:
    - summarize_research  # 요약본 기반으로 POV 생성 (토큰 최적화)

red_team_review:
  description: >
    ═══════════════════════════════════════════════════════════════
    🎯 VALIDATION GATE 판정 (초기 검증 가치 평가)
    ═══════════════════════════════════════════════════════════════
    
    ⚠️ 핵심 역할 재정의:
    ❌ "이 사업이 성공할까?"를 묻지 마라
    ✅ "이 아이디어에 시간과 비용(1~2주, 수십만 원)을 써서 초기 검증을 시도할 가치가 있는가?"를 판단하라
    
    [판정의 의미]
    - 🟢 GO: 외부 시장에서 초기 검증(Landing, PoC, Interview 등)을 시도할 준비가 됨
    - 🟡 HOLD: 아이디어는 흥미로우나, 실험 설계가 불완전함 (타깃/문제/가치 중 하나 더 구체화 필요)
    - 🔴 NO: 검증 단위가 성립하지 않음 (모호함, 상식 수준, 자기만의 착각 단계)
    
    [입력 아이디어 참조 - 반드시 확인]
    - 아이디어: {idea_one_liner}
    - 문제: {problem_statement}
    - 타깃: {target_customer}
    - 현재 대안: {current_alternatives}

    ═══════════════════════════════════════════════════════════════
    🚨 [Q0. IDEA INVARIANCE CHECK] - 아이디어 보존 검증 (최우선)
    ═══════════════════════════════════════════════════════════════
    
    다음을 비교하라:
    - **입력 아이디어**: {idea_one_liner}
    - **평가 대상 아이디어**: (create_pov_and_positioning에서 나온 것)
    
    [체크리스트 - 반드시 3개 모두 판정]
    1. 핵심 문제(core_problem)가 동일한가? → ✅/❌
       - 예: "감정 기록" ≠ "스트레스 즉시 회복" (다른 문제)
    2. 사용자의 주요 행동(primary_action)이 동일한가? → ✅/❌
       - 예: "기록하다" ≠ "즉시 회복하다" (다른 행동)
    3. 사용 맥락(usage_context)이 동일한가? → ✅/❌
       - 예: "비정기 회고" ≠ "실시간 즉각적" (다른 맥락)
    
    ═══════════════════════════════════════════════════════════════
    🚨 [Q0 판정 규칙 - 반드시 Reasoning Log 표와 일치!]
    ═══════════════════════════════════════════════════════════════
    - ✅ 3개 모두 일치 → Q0 = **PASS** (정상 진행)
    - ✅ 1~2개 일치, ❌ 1~2개 불일치 → Q0 = **PARTIAL** (HOLD 가중치 부여)
    - ❌ 3개 모두 불일치 → Q0 = **FAIL** (자동 LANDING_NO)
    
    ⚠️ Q0 = PARTIAL일 때: Q1~Q5 중 4개 이상 YES여도 최대 LANDING_HOLD
    ⚠️ Q0 = FAIL일 때: Q1~Q5와 관계없이 **자동 LANDING_NO**
    
    ═══════════════════════════════════════════════════════════════
    [Validation Gate 5가지 핵심 질문] - Q0 통과 시에만 평가
    ═══════════════════════════════════════════════════════════════
    
    ⚠️ 각 질문에 YES/NO를 판정할 때 **증거 출처**를 반드시 명시하라:
    
    [증거 출처 유형]
    - 📌 **입력명시**: 사용자 입력에서 직접 언급됨 (가장 강력)
    - 🔍 **경쟁사관찰**: 경쟁사 분석에서 확인됨 (중간)
    - ⚠️ **가정**: 입력/관찰에 없으나 추론함 (가장 약함)
    
    👉 **가정 기반 YES는 0.5점으로 계산** (예: YES 3개 + 가정YES 2개 = 4점)
    
    ---
    
    Q1. 이 아이디어는 특정 상황의 특정 사람을 떠올리게 하는가? (타깃 구체성)
    Q2. 그 사람은 이미 이 문제를 불편하다고 느끼고 있는가? (문제 인지)
    Q3. 기존 대안에 대해 짜증/아쉬움/불만이 있는가? (대안 불만)
    Q4. 이걸 한 문장 카피로 말할 수 있는가? (메시지 명확성)
    Q5. 이 카피를 보면 "어? 그게 돼?"라는 반응이 나올 수 있는가? (신선함/기대감)
    
    ═══════════════════════════════════════════════════════════════
    [판정 기준] - 점수 규칙: 입력/관찰=1.0, 가정=0.5, NO=0
    ═══════════════════════════════════════════════════════════════
    
    🟢 LANDING_GO (4점 이상)
       - Q0 = PASS 필수 (3개 모두 일치)
       - Q0 = PARTIAL이면 점수와 관계없이 최대 LANDING_HOLD
       - "외부 세계에서 초기 검증 실험을 시도할 가치가 충분함"
    
    🟡 LANDING_HOLD (2~3.5점)
       - Q0 = PASS 또는 PARTIAL
       - Q0 = PARTIAL이면 자동 HOLD (점수 높아도)
       - "소재는 흥미로우나, 실험 설계가 불완전함"
    
    🔴 LANDING_NO (0~1.5점 또는 Q0 실패)
       - Q0 = FAIL 시 자동 NO (점수 무관)
       - "현재 상태로는 검증 단위가 성립하지 않음"

    ═══════════════════════════════════════════════════════════════
    ⚠️ VERDICT 출력 규칙 (반드시 준수)
    ═══════════════════════════════════════════════════════════════
    - 마지막 줄은 반드시 "VERDICT: "로 시작해야 한다.
    - VERDICT 값은 LANDING_GO, LANDING_HOLD, LANDING_NO 중 **정확히 하나**여야 한다.
    - 마지막 줄 뒤에는 어떤 문자(공백/설명/줄바꿈)도 출력하지 마라.

  expected_output: >
    아래 형식의 마크다운을 출력하라:
    
    ## 🎯 Landing Gate 판정
    
    ---
    
    ### 🚨 Q0. 아이디어 보존 검증 (Idea Invariance Check)
    
    | 체크 항목 | 입력 | 평가 대상 | 판정 |
    |----------|------|----------|------|
    | 핵심 문제 (core_problem) | (입력에서) | (포지셔닝에서) | ✅ 동일 / ❌ 변경됨 |
    | 주요 행동 (primary_action) | (입력에서) | (포지셔닝에서) | ✅ 동일 / ❌ 변경됨 |
    | 사용 맥락 (usage_context) | (입력에서) | (포지셔닝에서) | ✅ 동일 / ❌ 변경됨 |
    
    **Q0 결과**: ✅ PASS / ⚠️ PARTIAL / ❌ FAIL 중 **정확히 하나만** 출력
    
    ---
    
    ### Q1~Q5 평가 (Evidence-based, 점수 규칙: 입력/관찰=1.0, 가정=0.5)
    
    | Q | 판정 | 근거 타입 | 점수 | 핵심 근거 (10자) |
    |---|------|----------|------|-----------------|
    | Q1 | ✅/❌ | 입력/관찰/가정 | X.X | (이유) |
    | Q2 | ✅/❌ | 입력/관찰/가정 | X.X | (이유) |
    | Q3 | ✅/❌ | 입력/관찰/가정 | X.X | (이유) |
    | Q4 | ✅/❌ | 입력/관찰/가정 | X.X | (이유) |
    | Q5 | ✅/❌ | 입력/관찰/가정 | X.X | (이유) |
    
    **총점: X.X / 5.0점**
    
    ---
    
    ### 🧠 판단 로그 (Reasoning Log)
    
    **[주요 가정]**
    - (어떤 가정을 사용했는지 명시)
    
    **[비약/확장 지점]**
    - (입력에서 추론이 발생한 부분)
    - (없으면 "없음")
    
    **[신뢰도 자체 평가]**
    - 이 판정의 신뢰도: 높음/중간/낮음
    - 이유: (왜 그렇게 판단했는지)
    
    ---
    
    ### [LANDING_GO인 경우]
    ## ✅ 다음 액션
    - 랜딩페이지 제작 권장
    - 헤드카피 A/B 테스트 후보: (2개)
    - 타깃 광고 키워드 5개
    
    ### [LANDING_HOLD인 경우]
    ## 🟡 모호한 지점
    - (무엇이 흐린지 구체적으로)
    
    ## 수정 가이드
    - (어떻게 포커싱하면 되는지)
    
    ### [LANDING_NO인 경우]
    ## 🔴 왜 지금은 아닌가
    - Q0 실패 시: "아이디어가 검증이 아닌 변환됨"
    - Q1~Q5 점수 부족 시: (구체적 이유)
    
    ## 대안 접근법
    - (장기 콘텐츠/교육 기반 등 다른 방법 제안)
    
    ---
    
    ⚠️ 마지막 줄에 반드시 VERDICT: 뒤에 LANDING_GO 또는 LANDING_HOLD 또는 LANDING_NO 중 하나만 적어라.
  agent: red_team
  context:
    - create_pov_and_positioning

# ============================================================================
# Revision 태스크 (--auto-revise 시에만 실행)
# ============================================================================

revise_positioning:
  description: >
    red_team_review의 Landing Gate 판정 결과를 반영하여
    create_pov_and_positioning의 Option A/B/C를 개선한 v2를 작성하라.

    ═══════════════════════════════════════════════════════════════
    [Revision-only 모드: 아래 내용이 있으면 참조, 없으면 context 참조]
    ═══════════════════════════════════════════════════════════════
    
    [이전 포지셔닝]
    {previous_positioning_output}
    
    [Red Team 판정]
    {previous_red_team_output}
    
    ═══════════════════════════════════════════════════════════════

    [수정 규칙]
    - red_team이 지적한 "모호한 지점" 상위 3개를 반드시 반영
    - 5가지 Landing Gate 질문 중 NO로 판정된 항목을 개선
    - 각 Option별로 "무엇을 어떻게 수정했는지" 수정 로그를 포함
    - 기존 구조(POV/Promise/RTB/Feature Focus/카피 초안)를 유지하되, 내용을 개선

    [Landing Gate 개선 초점]
    - Q1 (특정 사람/상황) NO → 타깃을 더 좁히고 구체화
    - Q2 (이미 불편) NO → Pain Point를 더 절실하게 표현
    - Q3 (대안에 불만) NO → 기존 대안의 구체적 문제점 추가
    - Q4 (한 문장 카피) NO → 카피를 더 명확하고 날카롭게
    - Q5 ("어? 그게 돼?") NO → 차별화된 가치를 더 강조

    [필수] 수정 후에도 남아있는 리스크/가정 3개를 명시하라

  expected_output: >
    positioning_options_v2.md 형태의 마크다운:
    - Option A/B/C (개선된 버전)
    - 각 Option별 수정 로그: [수정 전] → [수정 후] + 근거
    - 추천 Option 재선정 (변경 시 이유 명시)
    - **[REMAINING RISKS] 수정 후에도 남아있는 리스크/가정 Top 3**
  agent: pov_strategist
  context:
    - create_pov_and_positioning
    - red_team_review

red_team_recheck:
  description: >
    revise_positioning(v2)을 다시 검토하고, Landing Gate 재판정을 하라.

    ⚠️ 중요: 새로운 조사/확장은 하지 말고, 주어진 산출물만 비판하라.
    너는 "검토자"이지 "리서처"가 아니다. 추가 검색/스크래핑 금지.

    [입력 아이디어 참조 - 반드시 확인]
    - 아이디어: {idea_one_liner}
    - 문제: {problem_statement}
    - 타깃: {target_customer}

    ═══════════════════════════════════════════════════════════════
    🚨 [Q0. IDEA INVARIANCE CHECK] - 아이디어 보존 재검증
    ═══════════════════════════════════════════════════════════════
    
    revise_positioning이 아이디어를 더 변환시키지 않았는지 확인하라.
    
    - **입력 아이디어**: {idea_one_liner}
    - **수정된 포지셔닝**: (revise_positioning에서 나온 것)
    
    [체크리스트 - 반드시 3개 모두 판정]
    1. 핵심 문제(core_problem)가 동일한가? → ✅/❌
    2. 사용자의 주요 행동(primary_action)이 동일한가? → ✅/❌
    3. 사용 맥락(usage_context)이 동일한가? → ✅/❌
    
    [Q0 판정 규칙 - Reasoning Log 표와 반드시 일치!]
    - ✅ 3개 모두 일치 → Q0 = **PASS**
    - ✅ 1~2개 일치 → Q0 = **PARTIAL** (HOLD 가중치)
    - ❌ 0개 일치 → Q0 = **FAIL** (자동 LANDING_NO)
    
    ═══════════════════════════════════════════════════════════════
    [Landing Gate 5가지 질문 - Evidence-based 재평가]
    ═══════════════════════════════════════════════════════════════
    
    [증거 출처 유형]
    - 📌 **입력명시**: 사용자 입력에서 직접 언급됨 (1.0점)
    - 🔍 **경쟁사관찰**: 경쟁사 분석에서 확인됨 (1.0점)
    - ⚠️ **가정**: 입력/관찰에 없으나 추론함 (0.5점)
    
    Q1. 특정 상황의 특정 사람? → YES/NO + 증거출처
    Q2. 이미 불편하다고 느끼는가? → YES/NO + 증거출처
    Q3. 기존 대안에 짜증/불만? → YES/NO + 증거출처
    Q4. 한 문장 카피 가능? → YES/NO + 증거출처
    Q5. "어? 그게 돼?" 반응? → YES/NO + 증거출처

    [검토 관점]
    - 이전 red_team_review에서 지적한 모호한 지점이 해결되었는가?
    - 수정이 "표면적"이 아니라 "실질적"인가?
    - 아이디어가 더 변환되지 않고 유지되었는가?

    [판정 기준] - 점수 규칙: 입력/관찰=1.0, 가정=0.5, NO=0
    - Q0 PASS + 4점 이상 → LANDING_GO
    - Q0 PASS + 2~3.5점 → LANDING_HOLD
    - Q0 PARTIAL (1~2개 일치) → 점수 무관 최대 LANDING_HOLD
    - Q0 FAIL (0개 일치) 또는 0~1.5점 → LANDING_NO

    ⚠️ VERDICT 출력 규칙 (반드시 준수):
    - 마지막 줄은 반드시 "VERDICT: "로 시작해야 한다.
    - VERDICT 값은 LANDING_GO, LANDING_HOLD, LANDING_NO 중 **정확히 하나**여야 한다.
    - 마지막 줄 뒤에는 어떤 문자(공백/설명/줄바꿈)도 출력하지 마라.

  expected_output: >
    red_team_v2.md 형태의 마크다운:
    
    ## 🚨 Q0. 아이디어 보존 재검증
    
    | 체크 항목 | 입력 | 수정 후 | 판정 |
    |----------|------|--------|------|
    | 핵심 문제 | (입력) | (수정 후) | ✅/❌ |
    | 주요 행동 | (입력) | (수정 후) | ✅/❌ |
    | 사용 맥락 | (입력) | (수정 후) | ✅/❌ |
    
    **Q0 결과**: ✅ PASS / ⚠️ PARTIAL / ❌ FAIL 중 **정확히 하나만** 출력
    
    ---
    
    ## 이전 이슈 해결 상태
    - (이슈1): ✅/⚠️/❌
    - (이슈2): ✅/⚠️/❌
    
    ## Landing Gate 재평가 (Evidence-based)
    | 질문 | 판정 | 증거출처 | 점수 | 이유 |
    |------|------|----------|------|------|
    | Q1 | YES/NO | 📌/🔍/⚠️ | X.X | ... |
    | Q2 | YES/NO | 📌/🔍/⚠️ | X.X | ... |
    | Q3 | YES/NO | 📌/🔍/⚠️ | X.X | ... |
    | Q4 | YES/NO | 📌/🔍/⚠️ | X.X | ... |
    | Q5 | YES/NO | 📌/🔍/⚠️ | X.X | ... |
    
    **총점: X.X / 5.0점**
    
    ---
    
    ## 🧠 판단 로그
    - **주요 가정**: (사용된 가정)
    - **개선된 점**: (수정 전 대비)
    - **남은 문제**: (있다면)
    
    ---
    
    ⚠️ 마지막 줄에 반드시 VERDICT: 뒤에 LANDING_GO 또는 LANDING_HOLD 또는 LANDING_NO 중 하나만 적어라.
  agent: red_team
  context:
    - revise_positioning

final_step1_report:
  description: >
    모든 결과물을 통합하여 STEP1 최종 리포트를 작성하라.

    ═══════════════════════════════════════════════════════════════
    [입력 데이터]
    ═══════════════════════════════════════════════════════════════
    
    **원본 입력 아이디어 (반드시 참조)**:
    - 아이디어: {idea_one_liner}
    - 문제: {problem_statement}
    - 타깃: {target_customer}
    
    🎯 **Landing Gate 판정 결과 (필수 참조)**:
    {landing_gate_verdict}
    
    [리서치 요약]
    {research_summary}

    [빈틈 가설]
    {gap_hypotheses}

    ═══════════════════════════════════════════════════════════════
    🎯 STEP1 = Validation Gate
    ═══════════════════════════════════════════════════════════════
    
    이 리포트의 핵심 질문:
    "이 아이디어는 초기 검증(PoC, Landing, Interview 등)을 시도할 가치가 있는가?"
    
    ⚠️ VERDICT 사용 규칙:
    - 위에 주입된 {landing_gate_verdict} 값을 그대로 사용하라
    - LANDING_GO, LANDING_HOLD, LANDING_NO 중 하나가 들어있음
    - 해당 값에 맞는 섹션으로 리포트를 작성하라
    - 다른 추측이나 재해석 금지!

    ═══════════════════════════════════════════════════════════════
    🚦 [Validation Gate Snapshot - 리포트 최상단 고정]
    ═══════════════════════════════════════════════════════════════
    
    ⚠️ 아래 형식으로 **딱 한 번만** 출력하라. 
    사용자가 5초 안에 결론을 파악할 수 있어야 한다!
    
    ## 🚦 Validation Gate Snapshot (한눈 요약)
    
    **VERDICT: 🟢/🟡/🔴 LANDING_GO/HOLD/NO**
    **YES: N / 5 (총점 X.X / 5.0)**
    
    - ✅ 강한 점(N개): Q번호(설명), Q번호(설명)
    - ❌ 약한 점(N개): Q번호(설명), Q번호(설명)
    
    ### 왜 이 판정인가? (핵심 2줄)
    1) (첫 번째 핵심 이유)
    2) (두 번째 핵심 이유)
    
    ### Q표 (간략)
    | Q | 결과 | 근거 타입 |
    |---|------|----------|
    | Q0 | ✅ PASS / ⚠️ PARTIAL / ❌ FAIL | 동일/부분변경/변환됨 |
    | Q1 | ✅/❌ | 입력/관찰/가정 |
    | Q2 | ✅/❌ | 입력/관찰/가정 |
    | Q3 | ✅/❌ | 입력/관찰/가정 |
    | Q4 | ✅/❌ | 입력/관찰/가정 |
    | Q5 | ✅/❌ | 입력/관찰/가정 |
    
    **점수 규칙**: 입력/관찰 = 1.0점, 가정 = 0.5점, NO = 0점
    
    ---
    
    ═══════════════════════════════════════════════════════════════
    🎯 [검증 가능/불가 구분 - Snapshot 바로 아래]
    ═══════════════════════════════════════════════════════════════
    
    ## 🎯 이 아이디어에서 '지금' 검증되는 것 / 안 되는 것
    
    ### ✅ 지금 검증 가능한 것 (Landing Test로 바로 측정 가능)
    - (예: "의료진이 '감정 기록'이라는 행동을 하게 만드는 카피"에 반응하는가?)
    - (예: "진료 직후 10초 기록" 같은 구체 제안에 이메일을 남기는가?)
    
    ### ❌ 지금 상태에서 검증이 어려운 것 (랜딩만으로는 부족)
    - (예: 기록이 실제로 번아웃/만족도 개선으로 이어지는지)
    - (예: 반복 사용 습관이 생기는지)
    
    ---
    
    ═══════════════════════════════════════════════════════════════
    🧠 [판단 로그 - 검증 가능 블록 아래]
    ═══════════════════════════════════════════════════════════════
    
    ## 🧠 판단 로그 (Reasoning Log)
    
    ### Q0. 아이디어 보존 상세 (Reasoning Log와 반드시 일치)
    | 항목 | 원본 입력 | 평가에 사용된 것 | 동일 여부 |
    |------|----------|-----------------|----------|
    | 핵심 문제 | {problem_statement} | (포지셔닝에서 사용된 것) | ✅/❌ |
    | 주요 행동 | (입력에서) | (포지셔닝에서) | ✅/❌ |
    | 사용 맥락 | (입력에서) | (포지셔닝에서) | ✅/❌ |
    
    ⚠️ **Q0 판정 규칙 (Snapshot Q표와 반드시 일치)**:
    - 3개 모두 ✅ → Q0 = ✅ PASS
    - 1~2개 ✅ → Q0 = ⚠️ PARTIAL (HOLD 가중치)
    - 0개 ✅ → Q0 = ❌ FAIL (자동 LANDING_NO)
    
    ### 판정 근거 요약
    - **총점**: X.X / 5.0점
    - **📌 입력 기반 YES**: N개 × 1.0점
    - **🔍 관찰 기반 YES**: N개 × 1.0점
    - **⚠️ 가정 기반 YES**: N개 × 0.5점
    
    ### 주요 가정 목록 (투명성)
    - (사용된 가정 1)
    - (사용된 가정 2)
    - (없으면 "없음")
    
    ### 신뢰도 자체 평가
    - 이 판정의 신뢰도: **높음/중간/낮음**
    - 이유: (왜 그렇게 판단했는지)
    
    ---

    ═══════════════════════════════════════════════════════════════
    🟢 [LANDING_GO] 지금 당장 랜딩페이지 만들어도 된다
    ═══════════════════════════════════════════════════════════════
    
    [리포트 구성]
    1) ## 🎉 Landing Gate 통과!
       - 핵심 메시지: "광고 실험을 시작할 준비가 되었습니다"
       - Landing Gate 5가지 질문 결과 요약 (YES 개수)
    
    2) ## 🎯 타깃 고객 정의
       - 누구? (구체적 페르소나)
       - 언제? (문제를 느끼는 순간)
       - 왜 지금? (급박함/타이밍)
    
    3) ## 💬 시장 검증 메시지 후보 5개
       - 랜딩/DM/인터뷰용 카피 (실제로 바로 쓸 수 있는 수준)
       - 각 카피의 노리는 감정/반응
    
    4) ## 🔍 초기 실험 타깃팅 초안
       - 키워드 10개
       - 잠재 관심사/행동/채널 타깃
       - 예상 획득 비용 범위 (있다면)
    
    5) ## 📋 검증 가속 플랜 (7일)
       Day 1-2: 검증 환경(Landing, PoC, DM 등) 구축
       Day 3-4: 실험 세팅 및 채널 확보
       Day 5-7: 테스트 실행 + 데이터 수집
    
    6) ## 📊 성공 기준
       - 반응률(CTR, 오픈율 등) 기준
       - 전환(이메일, 데모 신청 등) 기준
       - 언제 "검증됨"으로 볼 것인가

    ═══════════════════════════════════════════════════════════════
    🟡 [LANDING_HOLD] 소재는 있지만 다듬어야 한다
    ═══════════════════════════════════════════════════════════════
    
    ⚠️ 핵심 메시지: "이건 실패가 아니라 포커싱 문제입니다"
    
    [리포트 구성]
    1) ## 🟡 Landing Gate: 조정 필요
       - Landing Gate 5가지 질문 결과
       - YES 개수: X/5 (어디가 부족한지)
    
    2) ## ⚠️ 모호한 지점들
       - 정확히 무엇이 흐린지 (구체적으로)
       - 왜 이게 랜딩에서 문제가 되는지
    
    3) ## 🔧 수정 가이드
       각 모호한 지점에 대해:
       - 현재 상태 → 목표 상태
       - 구체적인 수정 방향
       - 예시 (수정 전/후)
    
    4) ## 🎯 포커싱 옵션 (2~3개)
       - Option A: (이렇게 좁히면)
       - Option B: (저렇게 좁히면)
       - 각 옵션의 장단점
    
    5) ## 📋 다음 단계
       - 포커싱을 위해 확인해야 할 것들
       - 추천 인터뷰 질문 5개
       - 재검토까지 예상 시간

    ═══════════════════════════════════════════════════════════════
    🔴 [LANDING_NO] 지금은 광고 실험에 적합하지 않다
    ═══════════════════════════════════════════════════════════════
    
    ⚠️ 핵심 메시지: 
    - "사업성이 없다"가 아님!
    - "지금 Landing Test에는 안 맞는다"

    [리포트 구성]
    1) ## 🔴 Landing Gate: 현재는 부적합
       - Landing Gate 5가지 질문 결과
       - 핵심 문제: (왜 광고 반응이 안 나올지)
    
    2) ## 🧠 왜 지금은 아닌가
       - 고객이 아직 문제를 인식하지 못함
       - 또는 "있으면 좋겠다" 수준의 니즈
       - 단기 광고로는 설득이 어려운 이유
    
    3) ## 🔄 대안 접근법
       광고 대신 고려할 방법:
       - 콘텐츠 마케팅 (문제 인식 먼저)
       - 커뮤니티 빌딩
       - 교육 기반 접근
       - 대기자 리스트 (느린 빌드업)
    
    4) ## 📚 이 분석에서 배운 것
       - 경쟁 구도 관찰
       - 타깃 고객 인사이트
       - 나중에 활용할 수 있는 것들
    
    5) ## 🔮 언제 다시 시도할 수 있나
       - 어떤 조건이 바뀌면 재시도 가능
       - 또는 어떤 신호가 보이면

    ═══════════════════════════════════════════════════════════════
    [참고 섹션] STEP1-B: 사업성 메모
    ═══════════════════════════════════════════════════════════════
    ※ 이 섹션은 Landing 판정에 영향 없음. 장기 참고용.
    - 시장/경쟁 관련 관찰
    - 장기적 고려사항
    - 잠재적 리스크 (대기업 복제 등)

    ═══════════════════════════════════════════════════════════════
    [공통 규칙]
    ═══════════════════════════════════════════════════════════════
    - URL/근거를 포함해 재현 가능해야 한다.
    - 확신이 아닌 가정은 "가정"으로 표기
    - 아이디어를 늘리지 마라. 수렴이 목표다.
    - 톤: 실용적, 액션 중심, 감정적으로 건설적
    
    ═══════════════════════════════════════════════════════════════
    ⚠️ 절대 금지 (코드가 자동 삽입하므로 본문에서 생성 금지)
    ═══════════════════════════════════════════════════════════════
    
    [금지 1: 시간/통계]
    - **실행 시간/실행 통계/토큰/비용을 본문에 절대 포함하지 마라**
    - 본문에 "X분 Y초", "총 토큰", "추정 비용" 같은 표현 금지
    
    [금지 2: 코드 전용 섹션 헤더]
    아래 헤더는 코드가 자동 삽입하므로 **절대 본문에서 생성하지 마라**:
    - ## ⏱️ 실행 정보
    - ## 🧩 검증 대상 아이디어 (Idea Anchor)
    - ## 🚦 Landing Gate 결과 요약
    - ## 📊 토큰/비용 통계
    
    [금지 3: VERDICT 재선언]
    - 본문에서 "VERDICT: LANDING_GO" 같은 재선언 금지
    - 본문에서 "최종 판정: 🟢" 같은 이모지+판정 재선언 금지
    - VERDICT와 이모지는 코드가 header에서 삽입함
    
    본문은 **분석 내용만** 작성하고, 위 항목들은 시스템이 자동 처리함

  expected_output: >
    step1_report.md 형태의 마크다운:
    
    [LANDING_GO]
    - Landing Gate 통과 축하 + 즉시 실행 가이드
    - 헤드카피 5개 + 광고 키워드 10개
    - 7일 실행 플랜
    
    [LANDING_HOLD]
    - 모호한 지점 명확히 지적
    - 구체적인 수정 가이드
    - 포커싱 옵션 2~3개
    
    [LANDING_NO]
    - 왜 지금은 아닌지 (건설적 톤)
    - 대안 접근법 (광고 대신)
    - 학습 가치 + 재시도 조건
    
    [공통] STEP1-B 참고 섹션 (시장/경쟁 메모)
  agent: orchestrator
  context:
    - red_team_review
    - red_team_recheck
    - revise_positioning